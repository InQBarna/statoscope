{"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/tutorials\/statoscope\/01-04-injection"]}],"hierarchy":{"modules":[{"projects":[{"sections":[{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Create-a-scope","kind":"task"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Create-your-view","kind":"task"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Write-tests-and-acceptance-criterias","kind":"task"}],"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen"},{"sections":[{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects#What-is-a-side-effect","kind":"task"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects#Typed-effects","kind":"task"}],"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware","sections":[{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware#Logging-middleware","kind":"task"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware#Built-in-Library-logging","kind":"task"}]},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-04-Injection","sections":[{"kind":"task","reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-04-Injection#Designing-a-Dependency"}]},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes","sections":[{"kind":"task","reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes#Designing-Scopes"},{"reference":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes#Views-and-Scopes","kind":"task"}]}],"reference":"doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial\/Tutorials"}],"paths":[["doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial","doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial\/$volume","doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial\/Tutorials"]],"reference":"doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial"},"kind":"project","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-04-Injection"},"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Learn how to easily design dependencies and inject them into your scopes. Dependency injection simplifies the structure of your code by externalizing the management of dependencies, making your code more modular, testable, and flexible. In this tutorial, we will demonstrate dependency injection using an example of a simple news feed application."}]}],"title":"Dependency Injection","chapter":"Tutorials","kind":"hero","estimatedTimeInMinutes":30},{"tasks":[{"anchor":"Designing-a-Dependency","contentSection":[{"mediaPosition":"trailing","kind":"contentAndMedia","content":[{"inlineContent":[{"text":"External dependencies include system libraries, environmental factors, and third-party services that your app relies on. Examples include System Locale and Date formatting, Network responses, file system access, or user defaults and keychain data storage. These external services can vary in behavior, especially during testing, making them prime candidates for dependency abstraction and injection.","type":"text"}],"type":"paragraph"}]}],"title":"Designing a Dependency","stepsSection":[{"media":null,"code":"01-04-01-code-0001.swift","content":[{"type":"paragraph","inlineContent":[{"text":"Let’s build a simple example to illustrate the problem we want to solve. Consider the current state of our news feed app. The app displays a list of news articles, and users can mark some as favorites. However, the app directly interacts with the system’s date and persistence mechanisms, making testing difficult and inconsistent.","type":"text"}]}],"runtimePreview":null,"type":"step","caption":[]},{"media":null,"runtimePreview":null,"caption":[],"content":[{"inlineContent":[{"type":"text","text":"Before continuing with implementation, let’s define our acceptance criteria. We’ll use the StatoscopeTesting library to write tests that specify the expected behavior. Writing tests before implementation allows us to clearly define the behavior we expect, and helps prevent regressions in the future."}],"type":"paragraph"}],"type":"step","code":"01-04-01-code-0002.swift"},{"code":"01-04-01-code-0002.swift","type":"step","caption":[],"content":[{"type":"paragraph","inlineContent":[{"text":"Running the test results in a failure. The error occurs because the date of the saved favorite articles does not match the expected value. This happens because the system date is directly used within the business logic, making it hard to control during testing.","type":"text"}]}],"runtimePreview":null,"media":null},{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Additionally, if we want to write a test to ensure that favorites persist across multiple app runs, we face another problem. The current implementation directly interacts with UserDefaults for persistence, making it difficult to isolate and test this functionality without actually reading from or writing to the system’s storage."}]}],"type":"step","caption":[],"code":"01-04-01-code-0003.swift","media":null},{"content":[{"inlineContent":[{"type":"text","text":"To solve these problems, we’ll refactor our code to inject dependencies for both date retrieval and persistence. By injecting these dependencies, we can control their behavior during tests, leading to more predictable and testable code."}],"type":"paragraph"}],"media":null,"code":"01-04-01-code-0004.swift","caption":[],"type":"step","runtimePreview":null},{"code":"01-04-01-code-0005.swift","type":"step","media":null,"caption":[],"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Let’s start by defining our first dependency: a date provider. Instead of directly using "},{"code":"Date()","type":"codeVoice"},{"type":"text","text":", we’ll inject a "},{"type":"codeVoice","code":"DateProvider"},{"text":". This will allow us to mock the current date in tests, making date-based logic easier to verify.","type":"text"}]}],"runtimePreview":null},{"media":null,"content":[{"inlineContent":[{"type":"text","text":"Next, we’ll define a persistence provider to handle saving and loading favorite articles. This provider will abstract the interaction with UserDefaults, allowing us to inject a mock persistence layer during testing."}],"type":"paragraph"}],"caption":[],"runtimePreview":null,"type":"step","code":"01-04-01-code-0006.swift"},{"type":"step","runtimePreview":null,"media":null,"content":[{"inlineContent":[{"text":"Without using dependencies, the ","type":"text"},{"type":"codeVoice","code":"update"},{"text":" method of the news feed would directly interact with the system for date and persistence. This tightly couples the business logic to system APIs, making the code less flexible and harder to test.","type":"text"}],"type":"paragraph"}],"caption":[],"code":"01-04-01-code-0007.swift"},{"media":null,"caption":[],"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now that we’ve defined the dependencies, we can inject them into our "},{"code":"NewsFeedList","type":"codeVoice"},{"type":"text","text":" class. We use annotations like "},{"type":"codeVoice","code":"@Injected"},{"text":" to tell the system that these dependencies will be injected, rather than directly instantiated.","type":"text"}]}],"runtimePreview":null,"code":"01-04-01-code-0008.swift"},{"content":[{"inlineContent":[{"text":"With the dependencies injected, we can now modify the code to use the injected properties for date and persistence. This decouples the business logic from the system APIs and makes the code more modular and easier to test.","type":"text"}],"type":"paragraph"}],"media":null,"caption":[],"type":"step","code":"01-04-01-code-0009.swift","runtimePreview":null},{"runtimePreview":null,"media":null,"type":"step","caption":[],"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Let’s revisit our tests to ensure that the changes solve the original issues. We’ll rerun the same tests, now with mock dependencies for the date and persistence layers, and confirm that the app behaves as expected."}]}],"code":"01-04-01-code-0003.swift"},{"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Finally, we inject the date and persistence dependencies into our tests. This allows us to control the behavior of these dependencies during the test, ensuring that we can simulate various scenarios, such as a specific date or pre-existing favorites in the system."}]}],"caption":[],"media":null,"code":"01-04-01-code-0010.swift","runtimePreview":null},{"inlineContent":[{"type":"text","text":"By properly injecting external dependencies and defining clear boundaries between your business logic and third-party libraries, you can create a more maintainable, testable, and flexible codebase. Decoupling these dependencies allows you to focus on building robust business logic while safely leveraging external functionality."}],"type":"paragraph"}]}],"kind":"tasks"},{"abstract":[{"type":"text","text":"In complex applications, managing all state and events in a single Statostore quickly becomes unsustainable. To scale effectively, we need to split the app’s state and events into separate parts or Scopes. This process can sometimes be straightforward, but other times, developers may feel compelled to separate state and events that are closely tied together due to business logic. In this tutorial, we’ll focus on how to organize app state into different scopes to maintain scalability."}],"title":"Scopes","kind":"callToAction","action":{"type":"reference","isActive":true,"overridingTitleInlineContent":[{"text":"Get started","type":"text"}],"overridingTitle":"Get started","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes"},"featuredEyebrow":"Tutorial"}],"metadata":{"role":"project","categoryPathComponent":"StatoscopeTutorial","category":"Statoscope Architecture","title":"Dependency Injection"},"references":{"01-04-01-code-0001.swift":{"identifier":"01-04-01-code-0001.swift","content":["import Statoscope","","\/\/ Entities","struct DTO: Codable, Hashable {","    struct ListItem: Codable, Hashable {","        let id: String","        let title: String","        let url: String","    }","    let news: [ListItem]","}","struct Favorite: Hashable {","    let id: String","    let dateAdded: Date","}","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Implementation","    func update(_ when: When) throws {","        \/\/ TODO","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[]},"01-04-01-code-0006.swift":{"identifier":"01-04-01-code-0006.swift","content":["import Statoscope","","struct DateProvider: Injectable {","    var currentDate: () -> Date","    \/\/ Default value in case injection setup is invalid","    static var defaultValue = DateProvider(","        currentDate: Date.init","    )","}","","struct PersistenceProvider: Injectable {","    let get: () throws -> [Favorite]","    let set: ([Favorite]) throws -> Void","    \/\/ Default value in case injection setup is invalid","    static var defaultValue = PersistenceProvider(","        get: { try JSONDecoder().decode([Favorite].self, from: UserDefaults.value(forKey: \"newsfeed\") as? Data ?? Data()) },","        set: { try UserDefaults.setValue(JSONEncoder().encode($0), forKey: \"newsfeed\") }","    )","}","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Implementation","    func update(_ when: When) throws {","        \/\/ TODO","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[{"line":11},{"line":12},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20}]},"doc://Statoscope/tutorials/Statoscope/01-05-Scopes#Designing-Scopes":{"identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes#Designing-Scopes","url":"\/tutorials\/statoscope\/01-05-scopes#Designing-Scopes","role":"pseudoSymbol","abstract":[{"type":"text","text":"In complex applications, managing all state and events in a single Statostore quickly becomes unsustainable. To scale effectively, we need to split the app’s state and events into separate parts or Scopes. This process can sometimes be straightforward, but other times, developers may feel compelled to separate state and events that are closely tied together due to business logic. In this tutorial, we’ll focus on how to organize app state into different scopes to maintain scalability."}],"title":"Designing Scopes","kind":"section","type":"section"},"doc://Statoscope/tutorials/Statoscope/01-01-StateAndWhen#Write-tests-and-acceptance-criterias":{"title":"Write tests and acceptance criterias","abstract":[{"type":"text","text":"Define a scope object with state member variables representing"},{"text":" ","type":"text"},{"type":"text","text":"a part of your app’s status, define the events that may affect"},{"type":"text","text":" "},{"text":"this state, and create a view to display the state.","type":"text"}],"url":"\/tutorials\/statoscope\/01-01-stateandwhen#Write-tests-and-acceptance-criterias","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Write-tests-and-acceptance-criterias","role":"pseudoSymbol","type":"section","kind":"section"},"doc://Statoscope/tutorials/StatoscopeTutorial/Tutorials":{"kind":"article","abstract":[],"url":"\/tutorials\/statoscopetutorial\/tutorials","identifier":"doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial\/Tutorials","role":"article","type":"topic","title":"Tutorials"},"doc://Statoscope/tutorials/Statoscope/01-04-Injection":{"identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-04-Injection","role":"project","kind":"project","estimatedTime":"30min","type":"topic","url":"\/tutorials\/statoscope\/01-04-injection","abstract":[{"type":"text","text":"Learn how to easily design dependencies and inject them into your scopes. Dependency injection simplifies the structure of your code by externalizing the management of dependencies, making your code more modular, testable, and flexible. In this tutorial, we will demonstrate dependency injection using an example of a simple news feed application."}],"title":"Dependency Injection"},"doc://Statoscope/tutorials/Statoscope/01-03-Middleware":{"type":"topic","kind":"project","title":"Single entry point and\/or middlewares","role":"project","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware","url":"\/tutorials\/statoscope\/01-03-middleware","estimatedTime":"30min","abstract":[{"type":"text","text":"Understand how the single entry point enables pretty interesting features"}]},"01-04-01-code-0004.swift":{"identifier":"01-04-01-code-0004.swift","content":["import Statoscope","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Implementation","    func update(_ when: When) throws {","        \/\/ TODO","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[]},"01-04-01-code-0010.swift":{"identifier":"01-04-01-code-0010.swift","content":["import XCTest","import StatoscopeTesting","@testable import NewsFeed","","class NewsFeedTests: XCTestCase {","    func testFeatureUserCanSaveArticleAsFavorite() throws {","        let networkResponse = DTO(","            news: [","                DTO.ListItem(","                    id: \"1\",","                    title: \"Title 1\",","                    url: \"http:\/\/newsfeed.com\/article\/1\"","                )","            ]","        )","","        try NewsFeedList.GIVEN {","            NewsFeedList()","                .injectObject(DateProvider {","                    Date(timeIntervalSince1970: 1000)","                })","                .injectObject(","                    PersistenceProvider(","                        get: { [] },","                        set: { _ in }","                    )","                )","        }","        .WHEN(.systemLoadedScope)","        .THEN(\\.loading, equals: true)","        .WHEN(.networkDidFinish(networkResponse))","        .THEN(\\.loading, equals: false)","        .THEN(\\.loadedDTOs, equals: networkResponse)","        .WHEN(.navigateToChild(id: \"1\"))","        .THEN(\\.readingArticle?.lastPathComponent, equals: \"1\")","        .WHEN(.favorite(id: \"1\"))","        .THEN(\\.favorites, equals: [Favorite(id: \"1\", dateAdded: Date(timeIntervalSince1970: 1000))])","        .runTest()","    }","","    func testFeatureSavedFavoriteIsPersistedForSubsequentExecution() throws {","        try NewsFeedList.GIVEN {","            NewsFeedList()","                .injectObject(","                    PersistenceProvider(","                        get: { [Favorite(id: \"1\", dateAdded: Date(timeIntervalSince1970: 0))] },","                        set: { _ in XCTFail() }","                    )","                )","        }","        .WHEN(.systemLoadedScope)","        .THEN(\\.favorites, equals: [Favorite(id: \"1\", dateAdded: Date(timeIntervalSince1970: 0))])","        .runTest()","    }","}"],"syntax":"swift","fileName":"NewsFeedTests.swift","type":"file","fileType":"swift","highlights":[{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":37},{"line":44},{"line":45},{"line":46},{"line":47},{"line":48},{"line":49},{"line":52}]},"01-04-01-code-0003.swift":{"identifier":"01-04-01-code-0003.swift","content":["import XCTest","import StatoscopeTesting","@testable import NewsFeed","","class NewsFeedTests: XCTestCase {","    func testFeatureUserCanSaveArticleAsFavorite() throws {","        let networkResponse = DTO(","            news: [","                DTO.ListItem(","                    id: \"1\",","                    title: \"Title 1\",","                    url: \"http:\/\/newsfeed.com\/article\/1\"","                )","            ]","        )","","        try NewsFeedList.GIVEN {","            NewsFeedList()","        }","        .WHEN(.systemLoadedScope)","        .THEN(\\.loading, equals: true)","        .WHEN(.networkDidFinish(networkResponse))","        .THEN(\\.loading, equals: false)","        .THEN(\\.loadedDTOs, equals: networkResponse)","        .WHEN(.navigateToChild(id: \"1\"))","        .THEN(\\.readingArticle?.lastPathComponent, equals: \"1\")","        .WHEN(.favorite(id: \"1\"))","        .THEN(\\.favorites, equals: [Favorite(id: \"1\", dateAdded: Date())])","        .runTest()","    }","","    func testFeatureSavedFavoriteIsPersistedForSubsequentExecution() throws {","        try NewsFeedList.GIVEN {","            NewsFeedList()","        }","        .WHEN(.systemLoadedScope)","        \/\/ We can't simulate a previous execution of the app with some persistence","        .THEN(\\.favorites, equals: [Favorite(id: \"1\", dateAdded: Date())])","        .runTest()","    }","}"],"syntax":"swift","fileName":"NewsFeedTests.swift","type":"file","fileType":"swift","highlights":[]},"01-04-01-code-0007.swift":{"identifier":"01-04-01-code-0007.swift","content":["import Statoscope","","struct DateProvider: Injectable { \/* ... *\/ }","struct PersistenceProvider: Injectable { \/* ... *\/ }","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Implementation","    func update(_ when: When) throws {","        switch when {","        case .systemLoadedScope:","            loading = true","            loadedDTOs = nil","            let userPrefs = UserDefaults.value(forKey: \"newsfeed\") as? Data","            favorites = try JSONDecoder().decode([Favorite].self, from: userPrefs ?? Data())","        case .networkDidFinish(let dtos):","            loading = false","            loadedDTOs = dtos","        case .navigateToChild(let id):","            guard let article = loadedDTOs?.news.first(where: { $0.id == id }) else {","                throw InvalidStateError()","            }","            guard let articleUrl = URL(string: article.url) else {","                throw \"Invalid article\"","            }","            readingArticle = articleUrl","        case .favorite(let id):","            if let favIndex = favorites.firstIndex(where: { $0.id == id }) {","                favorites.remove(at: favIndex)","            } else {","                favorites.append(Favorite(id: id, dateAdded: Date()))","            }","            try UserDefaults.setValue(JSONEncoder().encode($0), forKey: \"newsfeed\")","        }","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[{"line":3},{"line":4},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42},{"line":43},{"line":44},{"line":45},{"line":46},{"line":47},{"line":48}]},"01-04-01-code-0005.swift":{"identifier":"01-04-01-code-0005.swift","content":["import Statoscope","","struct DateProvider: Injectable {","    var currentDate: () -> Date","    \/\/ Default value in case injection setup is invalid","    static var defaultValue = DateProvider(","        currentDate: Date.init","    )","}","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Implementation","    func update(_ when: When) throws {","        \/\/ TODO","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[{"line":3},{"line":4},{"line":5},{"line":6},{"line":7},{"line":8},{"line":9},{"line":10}]},"doc://Statoscope/tutorials/Statoscope/01-02-StateWhenAndEffects":{"abstract":[{"type":"text","text":"Trigger effects that will get back to your scope as a new When event."}],"kind":"project","title":"State, When and Effects","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects","type":"topic","estimatedTime":"30min","url":"\/tutorials\/statoscope\/01-02-statewhenandeffects","role":"project"},"01-04-01-code-0009.swift":{"identifier":"01-04-01-code-0009.swift","content":["import Statoscope","","struct DateProvider: Injectable { \/* ... *\/ }","struct PersistenceProvider: Injectable { \/* ... *\/ }","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Dependencies","    @Injected var date: DateProvider","    @Injected var persistence: PersistenceProvider","","    \/\/ Implementation","    func update(_ when: When) throws {","        switch when {","        case .systemLoadedScope:","            loading = true","            loadedDTOs = nil","            favorites = try persistence.get()","        case .networkDidFinish(let dtos):","            loading = false","            loadedDTOs = dtos","        case .navigateToChild(let id):","            guard let article = loadedDTOs?.news.first(where: { $0.id == id }) else {","                throw InvalidStateError()","            }","            guard let articleUrl = URL(string: article.url) else {","                throw \"Invalid article\"","            }","            readingArticle = articleUrl","        case .favorite(let id):","            if let favIndex = favorites.firstIndex(where: { $0.id == id }) {","                favorites.remove(at: favIndex)","            } else {","                favorites.append(Favorite(id: id, dateAdded: date.currentDate()))","            }","            try persistence.set(favorites)","        }","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[{"line":32},{"line":48},{"line":50}]},"doc://Statoscope/tutorials/Statoscope/01-01-StateAndWhen":{"type":"topic","kind":"project","title":"Create a simple Scope","role":"project","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen","url":"\/tutorials\/statoscope\/01-01-stateandwhen","estimatedTime":"20min","abstract":[{"type":"text","text":"Define a scope object with state member variables representing"},{"text":" ","type":"text"},{"text":"a part of your app’s status, define the events that may affect","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"this state, and create a view to display the state."}]},"doc://Statoscope/tutorials/Statoscope/01-01-StateAndWhen#Create-a-scope":{"kind":"section","abstract":[{"type":"text","text":"Define a scope object with state member variables representing"},{"text":" ","type":"text"},{"type":"text","text":"a part of your app’s status, define the events that may affect"},{"type":"text","text":" "},{"text":"this state, and create a view to display the state.","type":"text"}],"url":"\/tutorials\/statoscope\/01-01-stateandwhen#Create-a-scope","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Create-a-scope","role":"pseudoSymbol","type":"section","title":"Create a scope"},"doc://Statoscope/tutorials/Statoscope/01-03-Middleware#Logging-middleware":{"title":"Logging middleware","abstract":[{"type":"text","text":"Understand how the single entry point enables pretty interesting features"}],"url":"\/tutorials\/statoscope\/01-03-middleware#Logging-middleware","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware#Logging-middleware","role":"pseudoSymbol","type":"section","kind":"section"},"doc://Statoscope/tutorials/Statoscope/01-01-StateAndWhen#Create-your-view":{"kind":"section","abstract":[{"type":"text","text":"Define a scope object with state member variables representing"},{"text":" ","type":"text"},{"type":"text","text":"a part of your app’s status, define the events that may affect"},{"type":"text","text":" "},{"text":"this state, and create a view to display the state.","type":"text"}],"url":"\/tutorials\/statoscope\/01-01-stateandwhen#Create-your-view","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-01-StateAndWhen#Create-your-view","role":"pseudoSymbol","type":"section","title":"Create your view"},"doc://Statoscope/tutorials/Statoscope/01-03-Middleware#Built-in-Library-logging":{"kind":"section","abstract":[{"type":"text","text":"Understand how the single entry point enables pretty interesting features"}],"url":"\/tutorials\/statoscope\/01-03-middleware#Built-in-Library-logging","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-03-Middleware#Built-in-Library-logging","role":"pseudoSymbol","type":"section","title":"Built-in Library logging"},"doc://Statoscope/tutorials/Statoscope/01-05-Scopes":{"type":"topic","kind":"project","title":"Scopes","role":"project","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes","url":"\/tutorials\/statoscope\/01-05-scopes","estimatedTime":"30min","abstract":[{"type":"text","text":"In complex applications, managing all state and events in a single Statostore quickly becomes unsustainable. To scale effectively, we need to split the app’s state and events into separate parts or Scopes. This process can sometimes be straightforward, but other times, developers may feel compelled to separate state and events that are closely tied together due to business logic. In this tutorial, we’ll focus on how to organize app state into different scopes to maintain scalability."}]},"doc://Statoscope/tutorials/Statoscope/01-02-StateWhenAndEffects#Typed-effects":{"title":"Typed effects","abstract":[{"type":"text","text":"Trigger effects that will get back to your scope as a new When event."}],"url":"\/tutorials\/statoscope\/01-02-statewhenandeffects#Typed-effects","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects#Typed-effects","role":"pseudoSymbol","type":"section","kind":"section"},"doc://Statoscope/tutorials/Statoscope/01-02-StateWhenAndEffects#What-is-a-side-effect":{"kind":"section","abstract":[{"type":"text","text":"Trigger effects that will get back to your scope as a new When event."}],"url":"\/tutorials\/statoscope\/01-02-statewhenandeffects#What-is-a-side-effect","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-02-StateWhenAndEffects#What-is-a-side-effect","role":"pseudoSymbol","type":"section","title":"What is a side effect?"},"01-04-01-code-0008.swift":{"identifier":"01-04-01-code-0008.swift","content":["import Statoscope","","struct DateProvider: Injectable { \/* ... *\/ }","struct PersistenceProvider: Injectable { \/* ... *\/ }","","final class NewsFeedList: Statostore {","","    \/\/ Scope state","    var loading: Bool = false","    var loadedDTOs: DTO?","    var readingArticle: URL?","    var favorites: [Favorite] = []","","    \/\/ Scope When events","    enum When {","        case systemLoadedScope","        case networkDidFinish(DTO)","        case navigateToChild(id: String)","        case favorite(id: String)","    }","","    \/\/ Dependencies","    @Injected var date: DateProvider","    @Injected var persistence: PersistenceProvider","","    \/\/ Implementation","    func update(_ when: When) throws {","        switch when {","        case .systemLoadedScope:","            loading = true","            loadedDTOs = nil","            let userPrefs = UserDefaults.value(forKey: \"newsfeed\") as? Data","            favorites = try JSONDecoder().decode([Favorite].self, from: userPrefs ?? Data())","        case .networkDidFinish(let dtos):","            loading = false","            loadedDTOs = dtos","        case .navigateToChild(let id):","            guard let article = loadedDTOs?.news.first(where: { $0.id == id }) else {","                throw InvalidStateError()","            }","            guard let articleUrl = URL(string: article.url) else {","                throw \"Invalid article\"","            }","            readingArticle = articleUrl","        case .favorite(let id):","            if let favIndex = favorites.firstIndex(where: { $0.id == id }) {","                favorites.remove(at: favIndex)","            } else {","                favorites.append(Favorite(id: id, dateAdded: Date()))","            }","            try UserDefaults.setValue(JSONEncoder().encode($0), forKey: \"newsfeed\")","        }","    }","}"],"syntax":"swift","fileName":"NewsFeed.swift","type":"file","fileType":"swift","highlights":[{"line":22},{"line":23},{"line":24},{"line":25}]},"doc://Statoscope/tutorials/Statoscope/01-04-Injection#Designing-a-Dependency":{"title":"Designing a Dependency","abstract":[{"type":"text","text":"Learn how to easily design dependencies and inject them into your scopes. Dependency injection simplifies the structure of your code by externalizing the management of dependencies, making your code more modular, testable, and flexible. In this tutorial, we will demonstrate dependency injection using an example of a simple news feed application."}],"url":"\/tutorials\/statoscope\/01-04-injection#Designing-a-Dependency","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-04-Injection#Designing-a-Dependency","role":"pseudoSymbol","type":"section","kind":"section"},"doc://Statoscope/tutorials/StatoscopeTutorial":{"identifier":"doc:\/\/Statoscope\/tutorials\/StatoscopeTutorial","role":"overview","kind":"overview","type":"topic","url":"\/tutorials\/statoscopetutorial","abstract":[{"type":"text","text":"Statoscope is a small library to build apps with state management,"},{"type":"text","text":" "},{"type":"text","text":"testing, effects management and dependency injection."}],"title":"Statoscope basics"},"doc://Statoscope/tutorials/Statoscope/01-05-Scopes#Views-and-Scopes":{"title":"Views and Scopes","abstract":[{"type":"text","text":"In complex applications, managing all state and events in a single Statostore quickly becomes unsustainable. To scale effectively, we need to split the app’s state and events into separate parts or Scopes. This process can sometimes be straightforward, but other times, developers may feel compelled to separate state and events that are closely tied together due to business logic. In this tutorial, we’ll focus on how to organize app state into different scopes to maintain scalability."}],"url":"\/tutorials\/statoscope\/01-05-scopes#Views-and-Scopes","identifier":"doc:\/\/Statoscope\/tutorials\/Statoscope\/01-05-Scopes#Views-and-Scopes","role":"pseudoSymbol","type":"section","kind":"section"},"01-04-01-code-0002.swift":{"identifier":"01-04-01-code-0002.swift","content":["import XCTest","import StatoscopeTesting","@testable import NewsFeed","","class NewsFeedTests: XCTestCase {","    func testFeatureUserCanSaveArticleAsFavorite() throws {","        let networkResponse = DTO(","            news: [","                DTO.ListItem(","                    id: \"1\",","                    title: \"Title 1\",","                    url: \"http:\/\/newsfeed.com\/article\/1\"","                )","            ]","        )","","        try NewsFeedList.GIVEN {","            NewsFeedList()","        }","        .WHEN(.systemLoadedScope)","        .THEN(\\.loading, equals: true)","        .WHEN(.networkDidFinish(networkResponse))","        .THEN(\\.loading, equals: false)","        .THEN(\\.loadedDTOs, equals: networkResponse)","        .WHEN(.navigateToChild(id: \"1\"))","        .THEN(\\.readingArticle?.lastPathComponent, equals: \"1\")","        .WHEN(.favorite(id: \"1\"))","        .THEN(\\.favorites, equals: [Favorite(id: \"1\", dateAdded: Date())])","        .runTest()","    }","}"],"syntax":"swift","fileName":"NewsFeedTests.swift","type":"file","fileType":"swift","highlights":[]}}}